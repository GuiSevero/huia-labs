<div id="subscriptions">
	<% if(status.code != 200) {%>
		<h3>Error <%= status.code %> - <%= status.message %> </h3>
		<p> <%= meta.error_type %> - <%= meta.error_message %> </p>
	<% } %>
	<form id="form" method="POST">
		<select name="object" class="form-object" required>
			<option value="tag">Tag</option>
			<option value="location">Location</option>
			<option value="geography">Geography</option>
		</select>
		<br />
		<input type="text" name="object_id" placeholder="object id. eg: hashtag, uid, etc" required><br />
		<div class="geography-group">
			<hr>
			<div class="geo-inputs">
				<input class="geography-value" id="lat" type="text" name="lat" placeholder="latitude" ><br />
				<input class="geography-value" id="lng" type="text" name="lng" placeholder="longitude" ><br />
				<label for="geography-value">Raio</label>
				<input 
					id="geography-value"
					class="geography-value"
					type="range"
					min="500"
					max="1500"
					name="radius"
					value="500" 
					placeholder="radius">
				<span id="geo-radius">500</span> metros<br />
			</div>
			<div id="map-canvas"></div>
			<hr>
		</div>
		<input type="submit">
	</form>

	<table>
		<th>Object</th><th>Objeto Id</th><th>Aspect</th><th>Callback Url</th><th>Type</th><th>Id</th><th>Options</th>
		<% for(var i in subscriptions) {%>
		   <tr>
		   		<td><%= subscriptions[i].object %></td>
		   		<td>#<%= subscriptions[i].object_id %></td>
		   		<td><%= subscriptions[i].aspect %></td>
		   		<td><%= subscriptions[i].callback_url %></td>
		   		<td><%= subscriptions[i].type %></td>
		   		<td><%= subscriptions[i].id %></td>
		   		<td>
		   		<a class="delete-subscription" href="#" data-subscription-id="<%= subscriptions[i].id %>">Delete</a>
		   		</td>
		   </tr>
		<% } %>
	</table>
</div>

<script type="text/javascript"> 
  $('.delete-subscription').click(function(){
  		alert($(this).data('subscription-id'));
  });

  $('#form').submit(function(){
  	console.log($(this).serialize());
  	return false;
  });

  $('.form-object').change(function(){
  	return;

  	if($(".form-object option:selected" ).val() == 'geography'){
  		$('.geography-group').show();
  	}else{
  		$('.geography-group').hide();
  		$('.geography-value').val('');
  	}

  });

</script>
<script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCG5nl0KVUWrI-XKX2e9C3Fh1Df126OgiA"></script>
<script type="text/javascript">

	var marker, circle;

function initialize() {
    var mapOptions = {
        center: {
            lat: -30.028571002398685,
            lng: -51.20356857776642
        },
        zoom: 15
    };

    var circleOpt = {
        strokeColor: '#FF0000',
        strokeOpacity: 0.8,
        strokeWeight: 2,
        fillColor: '#FF0000',
        fillOpacity: 0.35,
        draggable: true
    };

    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
    
    // Add the circle for this city to the map.
    circle = new google.maps.Circle($.extend(circleOpt,{
    	map:map,
    	center: map.getCenter(),
    	radius:  $('#geography-value').val() / Math.PI
    }));

    google.maps.event.addListener(map, 'click', function(e) {
        $("#lat").val(e.latLng.A);
        $("#lng").val(e.latLng.F);
        circle.setCenter(e.latLng);
    });

    google.maps.event.addListener(circle, 'drag', function(e) {
        $("#lat").val(e.latLng.A);
        $("#lng").val(e.latLng.F);
        circle.setCenter(e.latLng);
    });

    $('#geography-value').on('mousemove', function(){
    	$('#geo-radius').html($(this).val());
    	circle.setRadius($(this).val()  / (Math.PI));
    })
}

google.maps.event.addDomListener(window, 'load', initialize);

</script>
